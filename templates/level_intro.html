<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Level Introduction</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        #intro-wrapper {
            width: 80%;
            max-width: 800px;
            margin: auto;
            text-align: center;
        }
        #intro-text {
            font-size: 24px;
            line-height: 1.5;
            text-align: left; /* Left align during typing */
            word-wrap: break-word;
        }
        #start-button {
            position: fixed;
            bottom: 20px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="intro-wrapper">
        <div id="intro-text"></div>
    </div>
    <button id="start-button">Start Game</button>

    <script>
        // Escape backslashes and newlines in intro_text
        const introText = `{{ intro_text | replace('\\', '\\\\') | replace('\n', '\\n') }}`;
        const printSpeed = {{ print_speed }};
        const levelId = `{{ level_id }}`;

        function displayText(text, speed) {
            const textContainer = document.getElementById('intro-text');

            // Split the text into paragraphs based on \n
            const paragraphs = text.split('\\n');

            let paragraphIndex = 0;
            let wordIndex = 0;
            let words = paragraphs[paragraphIndex].split(' ');

            function displayNextWord() {
                if (wordIndex < words.length) {
                    const span = document.createElement('span');
                    span.textContent = words[wordIndex] + ' ';
                    textContainer.appendChild(span);
                    wordIndex++;
                    setTimeout(displayNextWord, speed);
                } else {
                    // Finished current paragraph, move to next
                    paragraphIndex++;
                    if (paragraphIndex < paragraphs.length) {
                        // Add two line breaks for new paragraph
                        textContainer.appendChild(document.createElement('br'));
                        textContainer.appendChild(document.createElement('br'));
                        words = paragraphs[paragraphIndex].split(' ');
                        wordIndex = 0;
                        setTimeout(displayNextWord, speed);
                    } else {
                        // Finished all paragraphs
                        // Center the text
                        textContainer.style.textAlign = 'center';
                    }
                }
            }

            displayNextWord();
        }

        // Start displaying text
        displayText(introText, printSpeed);

        // Handle Start Game button
        document.getElementById('start-button').addEventListener('click', () => {
            window.location.href = `/start_game/${levelId}`;
        });
    </script>
</body>
</html>